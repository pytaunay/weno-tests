function UN = WENO5(U,J,LorR,NCELL)

BIG = 1e20;

% Calculate BETA's
if(J == 1)
    b0 = 13/12*(U(J,1) - 2*U(J+1,1) + U(J+2,1))^2 + 1/4*(3*U(J,1) - 4*U(J+1,1) + U(J+2,1))^2;
    b1 = 13/12*(BIG - 2*U(J,1) + U(J+1,1))^2 + 1/4*(BIG - U(J+1,1))^2;
    b2 = 13/12*(BIG - 2*BIG + U(J,1))^2 + 1/4*(BIG - 4*BIG + 3*U(J,1))^2;    
elseif ( J == 2 )
    b0 = 13/12*(U(J,1) - 2*U(J+1,1) + U(J+2,1))^2 + 1/4*(3*U(J,1) - 4*U(J+1,1) + U(J+2,1))^2;
    b1 = 13/12*(U(J-1,1) - 2*U(J,1) + U(J+1,1))^2 + 1/4*(U(J-1,1) - U(J+1,1))^2;
    b2 = 13/12*(BIG - 2*U(J-1,1) + U(J,1))^2 + 1/4*(BIG - 4*U(J-1,1) + 3*U(J,1))^2;        
elseif ( J == NCELL-1 )
    b0 = 13/12*(U(J,1) - 2*U(J+1,1) + BIG)^2 + 1/4*(3*U(J,1) - 4*U(J+1,1) + BIG)^2;
    b1 = 13/12*(U(J-1,1) - 2*U(J,1) + U(J+1,1))^2 + 1/4*(U(J-1,1) - U(J+1,1))^2;
    b2 = 13/12*(U(J-2,1) - 2*U(J-1,1) + U(J,1))^2 + 1/4*(U(J-2,1) - 4*U(J-1,1) + 3*U(J,1))^2;
elseif ( J == NCELL )
    b0 = 13/12*(U(J,1) - 2*BIG + BIG)^2 + 1/4*(3*U(J,1) - 4*BIG + BIG)^2;
    b1 = 13/12*(U(J-1,1) - 2*U(J,1) + BIG)^2 + 1/4*(U(J-1,1) - BIG)^2;
    b2 = 13/12*(U(J-2,1) - 2*U(J-1,1) + U(J,1))^2 + 1/4*(U(J-2,1) - 4*U(J-1,1) + 3*U(J,1))^2;
else
    b0 = 13/12*(U(J,1)   - 2*U(J+1,1)   + U(J+2,1))^2   + 1/4*(3*U(J,1) - 4*U(J+1,1) + U(J+2,1))^2;
    b1 = 13/12*(U(J-1,1) - 2*U(J,1)     + U(J+1,1))^2   + 1/4*(U(J-1,1) - U(J+1,1))^2;
    b2 = 13/12*(U(J-2,1) - 2*U(J-1,1)   + U(J,1))^2     + 1/4*(U(J-2,1) - 4*U(J-1,1) + 3*U(J,1))^2;
end
      
if(LorR == 'L')
   
    d0 = 0.3;
    d1 = 0.6;
    d2 = 0.1;
    
    % Calculate the order 3 stencils
    if(J == 1)
        U0 = 1/3*U(J,1) + 5/6*U(J+1,1) - 1/6*U(J+2,1);
        U1 = -1/6*BIG + 5/6*U(J,1) +1/3*U(J+1,1);
        U2 = 1/3*BIG - 7/6*BIG + 11/6*U(J,1);
    elseif ( J == 2 )
        U0 = 1/3*U(J,1) + 5/6*U(J+1,1) - 1/6*U(J+2,1);
        U1 = -1/6*U(J-1,1) + 5/6*U(J,1) +1/3*U(J+1,1);
        U2 = 1/3*BIG - 7/6*U(J-1,1) + 11/6*U(J,1);        
    elseif ( J == NCELL-1 )
        U0 = 1/3*U(J,1) + 5/6*U(J+1,1) - 1/6*BIG;
        U1 = -1/6*U(J-1,1) + 5/6*U(J,1) +1/3*U(J+1,1);
        U2 = 1/3*U(J-2,1) - 7/6*U(J-1,1) + 11/6*U(J,1);        
    elseif ( J == NCELL )
        U0 = 1/3*U(J,1) + 5/6*BIG - 1/6*BIG;
        U1 = -1/6*U(J-1,1) + 5/6*U(J,1) +1/3*BIG;
        U2 = 1/3*U(J-2,1) - 7/6*U(J-1,1) + 11/6*U(J,1);        
    else
        U0 = 1/3*U(J,1)     + 5/6*U(J+1,1)  - 1/6*U(J+2,1);
        U1 = -1/6*U(J-1,1)  + 5/6*U(J,1)    + 1/3*U(J+1,1);
        U2 = 1/3*U(J-2,1)   - 7/6*U(J-1,1)  + 11/6*U(J,1);
       
    end
    
    
elseif(LorR == 'R')
    d0 = 0.1;
    d1 = 0.6;
    d2 = 0.3;
    
    % Calculate the order 3 stencils
    if(J == 1)
        U0 = 11/6*U(J,1)    - 7/6*U(J+1,1)  + 1/3*U(J+2,1);
        U1 = 1/3*BIG        + 5/6*U(J,1)    - 1/6*U(J+1,1);
        U2 = -1/6*BIG       + 5/6*BIG       + 1/3*U(J,1);
    elseif ( J == 2 )
        U0 = 11/6*U(J,1)    - 7/6*U(J+1,1)  + 1/3*U(J+2,1);
        U1 = 1/3*U(J-1,1)   + 5/6*U(J,1)    - 1/6*U(J+1,1);
        U2 = -1/6*BIG       + 5/6*U(J-1,1)  + 1/3*U(J,1);        
    elseif ( J == NCELL-1 )
        U0 = 11/6*U(J,1)    - 7/6*U(J+1,1)  + 1/3*BIG;
        U1 = 1/3*U(J-1,1)   + 5/6*U(J,1)    - 1/6*U(J+1,1);
        U2 = -1/6*U(J-2,1)  + 5/6*U(J-1,1)  + 1/3*U(J,1);       
    elseif ( J == NCELL )
        U0 = 11/6*U(J,1)    - 7/6*BIG       + 1/3*BIG;
        U1 = 1/3*U(J-1,1)   + 5/6*U(J,1)    - 1/6*BIG;
        U2 = -1/6*U(J-2,1)  + 5/6*U(J-1,1)  + 1/3*U(J,1);
    else
        U0 = 11/6*U(J,1)    - 7/6*U(J+1,1)  + 1/3*U(J+2,1);
        U1 = 1/3*U(J-1,1)   + 5/6*U(J,1)    - 1/6*U(J+1,1);
        U2 = -1/6*U(J-2,1)  + 5/6*U(J-1,1)  + 1/3*U(J,1);         
    end
    
    
end
a0 = d0/(1e-6+b0)^2;
a1 = d1/(1e-6+b1)^2;
a2 = d2/(1e-6+b2)^2;

s = a0+a1+a2;
w0 = a0/s;
w1 = a1/s;
w2 = a2/s;

UN = w0*U0 + w1*U1 + w2*U2;


end